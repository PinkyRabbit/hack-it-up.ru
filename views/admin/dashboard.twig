{% extends '../layout.twig' %}

{% block bodyblock %}
  {% if posts %}
    <h3>Неопубликованные материалы</h3>
    <ul class="list-group">
    {% for post in posts %}
      <li class="list-group-item">
        {{ post.createdAt }}
        <a href="/admin/article/{{ post._id }}/edit">{{ post.h1 }}</a>
        <a href="/admin/article/{{ post._id }}/delete" class="delete-x">X</a>
      </li>
    {% endfor %}
    </ul>
  {% else %}
    <h3>Неопубликованных материалов нет...</h3>
  {% endif %}

  {% if categories %}
    <h3>Категории</h3>
    {% for index, category in categories %}
    {% if index != 0 %}<hr />{% endif %}
    <form action="/admin/category/{{category._id}}/update" method="PUT">
      <div class="form-group">
        <label for="catname{{index}}">Имя категории</label>
        <input type="text" id="catname{{index}}" name="name" value="{{category.name}}" class="form-control" />
      </div>
      <div class="form-group">
        <label for="catdescription{{index}}">Краткое описание</label>
        <textarea id="catdescription{{index}}" name="description" class="form-control" rows="3">{{category.description}}</textarea>
      </div>
      <div class="form-group">
        <label for="catkeywords{{index}}">Ключики</label>
        <input type="text" id="catkeywords{{index}}" name="keywords" value="{{category.keywords}}" class="form-control" />
      </div>
      <a href="#" id="cat-{{category._id}}" class="btn btn-default catdel">Удалить</a>
      <button type="submit" class="btn btn-success">Сохранить</button>
    </form>
    {% endfor %}
    <script>
      var categoryButtons = document.getElementsByClassName('catdel');
      console.log(categoryButtons);
      console.log(categoryButtons);
      Array.from(categoryButtons).forEach(function(element) {
          element.onclick = function(e) {
            var {target} = e;
            e.preventDefault();
            var r = confirm("Вы точно хотите удалить категорию?");
            if (r == true) {
              target.dispatchEvent('click');
            }
          };
        });

    </script>
  {% else %}
    <h3>Созданных категорий нет...</h3>
  {% endif %}

  {% if tags %}
    <h3>Теги</h3>
    <table class="table">
      <thead>
        <tr>
          <td>name</td>
          <td>url</td>
          <td>act</td>
        </tr>
      </thead>
      <tbody>
        {% for tag in tags %}
          <tr>
            <td><input name="name" value="{{tag.name}}" /></td>
            <td><input name="slug" value="{{tag.slug}}" /></td>
            <td>
              <a href="/admin/tag/{{tag._id}}/delete">X</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <h3>Созданных тегов нет...</h3>
  {% endif %}
{% endblock %}
